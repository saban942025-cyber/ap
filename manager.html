<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CRM - לוח בקרה | ח.סבן</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Assistant:wght@400;600;700;800&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --primary: #1e3a8a; --secondary: #3b82f6; --accent: #f59e0b; 
            --bg-main: #f1f5f9; --bg-sidebar: #0f172a; --card: #ffffff;
            --text-light: #f8fafc; --text-dark: #1e293b; --text-muted: #64748b;
            --border: #e2e8f0; --success: #22c55e; --warning: #f97316; --danger: #ef4444;
            --radius: 12px; --shadow: 0 4px 6px -1px rgba(0,0,0,0.1), 0 2px 4px -2px rgba(0,0,0,0.1);
        }
        body { margin: 0; font-family: 'Assistant', sans-serif; background-color: var(--bg-main); color: var(--text-dark); display: flex; overflow-x: hidden; }
        .sidebar { width: 250px; background-color: var(--bg-sidebar); color: var(--text-light); display: flex; flex-direction: column; padding: 20px; height: 100vh; position: fixed; right: 0; top: 0; box-sizing: border-box; }
        .logo { font-size: 24px; font-weight: 800; text-align: center; margin-bottom: 40px; color: var(--accent); }
        .nav-menu { flex-grow: 1; }
        .nav-menu a { display: flex; align-items: center; gap: 12px; color: #cbd5e1; text-decoration: none; padding: 12px 15px; border-radius: 8px; margin-bottom: 8px; font-weight: 600; transition: background-color 0.2s, color 0.2s; }
        .nav-menu a:hover, .nav-menu a.active { background-color: rgba(59, 130, 246, 0.2); color: var(--text-light); }
        .nav-menu a svg { width: 20px; height: 20px; }
        .user-info { border-top: 1px solid #334155; padding-top: 15px; text-align: center; }
        .main-content { margin-right: 250px; width: calc(100% - 250px); padding: 30px; }
        .page { display: none; }
        .page.active { display: block; animation: fadeIn 0.5s; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { { opacity: 1; transform: translateY(0); } } }
        .page-header { margin-bottom: 30px; }
        .page-header h1 { margin: 0 0 5px 0; font-size: 28px; }
        .page-header p { margin: 0; color: var(--text-muted); }
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .stat-card { background-color: var(--card); padding: 20px; border-radius: var(--radius); box-shadow: var(--shadow); }
        .stat-card .value { font-size: 32px; font-weight: 800; }
        .charts-grid { display: grid; grid-template-columns: 2fr 1fr; gap: 20px; }
        .chart-container { background-color: var(--card); padding: 20px; border-radius: var(--radius); box-shadow: var(--shadow); position: relative; height: 350px; }
        .main-board { display: grid; grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)); gap: 20px; align-items: start; }
        .column { background-color: #eef2ff; border-radius: var(--radius); padding: 15px; display: flex; flex-direction: column; }
        .column-title { font-size: 18px; font-weight: 700; margin-bottom: 15px; padding: 0 5px 10px; border-bottom: 2px solid var(--border); }
        .cards-container { flex-grow: 1; min-height: 200px; padding-top: 10px; }
        .card { background-color: var(--card); border-radius: 8px; box-shadow: var(--shadow); padding: 15px; margin-bottom: 10px; cursor: pointer; transition: transform 0.2s, box-shadow 0.2s; }
        .card:hover { transform: translateY(-3px); box-shadow: 0 8px 15px -3px rgba(0,0,0,0.1); }
        .card.dragging { opacity: 0.5; transform: rotate(3deg); }
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.6); display: none; justify-content: center; align-items: center; z-index: 1000; backdrop-filter: blur(5px); }
        .modal-content { background-color: white; padding: 25px; border-radius: var(--radius); width: 90%; max-width: 600px; animation: modal-pop 0.3s ease-out; }
        @keyframes modal-pop { from { transform: scale(0.9); opacity: 0; } to { transform: scale(1); opacity: 1; } }
        .modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; border-bottom: 1px solid var(--border); padding-bottom: 15px; }
        .modal-title { font-size: 20px; font-weight: 700; }
        .modal-close { background: none; border: none; font-size: 24px; cursor: pointer; color: var(--text-muted); }
        .btn { padding: 12px 20px; border: none; border-radius: 8px; font-weight: 700; cursor: pointer; }
        .btn-primary { background-color: var(--primary); color: white; }
    </style>
</head>
<body>
    <aside class="sidebar">
        <div class="logo">ח.סבן CRM</div>
        <nav class="nav-menu">
            <a href="#" class="nav-link active" data-page="dashboard"><svg fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"/></svg>לוח בקרה</a>
            <a href="#" class="nav-link" data-page="orders"><svg fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 17v-2m3 2v-4m3 4v-6m2 10H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/></svg>ניהול הזמנות</a>
            <a href="#" class="nav-link" data-page="clients"><svg fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M15 21a6 6 0 00-9-5.197m0 0A5.995 5.995 0 0012 12.75a5.995 5.995 0 00-3-5.197m0 0A4 4 0 1112 4.354m0 0a4 4 0 110 5.292"/></svg>ניהול לקוחות</a>
        </nav>
        <div class="user-info"><span id="manager-name">מנהל</span></div>
    </aside>

    <div class="main-content">
        <!-- Dashboard Page -->
        <div id="dashboard-page" class="page active">
            <div class="page-header"><h1>לוח בקרה ראשי</h1><p>סקירה כללית על הפעילות במערכת בזמן אמת</p></div>
            <div class="stats-grid">
                <div class="stat-card"><div class="value" id="stat-total-orders">0</div><div class="label">סה"כ הזמנות</div></div>
                <div class="stat-card"><div class="value" id="stat-new-orders">0</div><div class="label">הזמנות חדשות</div></div>
                <div class="stat-card"><div class="value" id="stat-active-clients">0</div><div class="label">לקוחות במערכת</div></div>
                <div class="stat-card"><div class="value" id="stat-completed-today">0</div><div class="label">הושלמו היום</div></div>
            </div>
            <div class="charts-grid">
                <div class="chart-container"><h3>פעילות שבועית</h3><canvas id="dailyActivityChart"></canvas></div>
                <div class="chart-container"><h3>הזמנות לפי סטטוס</h3><canvas id="statusPieChart"></canvas></div>
            </div>
        </div>
        <!-- Other pages here -->
        <div id="orders-page" class="page">...</div>
        <div id="clients-page" class="page">...</div>
    </div>
    
    <div id="action-modal" class="modal-overlay"></div>
    <audio id="notification-sound" src="data:audio/wav;base64,UklGRiQAAABXQVZFZm10IBAAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA"></audio>

    <script>
        // IMPORTANT: PASTE YOUR GOOGLE APPS SCRIPT URL HERE
        const SCRIPT_URL = "URL_DO_SCRIPT_AQUI";

        let allRequests = [], allClients = [];
        let dailyActivityChart, statusPieChart;

        document.addEventListener('DOMContentLoaded', () => {
            setupNavigation();
            fetchData();
            // setInterval(fetchData, 60000); // Refresh data every 60 seconds
        });

        function setupNavigation() {
            // ... same as before
        }

        async function fetchData() {
            try {
                const response = await fetch(`${SCRIPT_URL}?route=getData`);
                const data = await response.json();
                
                const newRequestIds = new Set(data.requests.filter(r => r.סטטוס === 'חדש').map(r => r.תעודה));
                const oldNewRequestIds = new Set(allRequests.filter(r => r.סטטוס === 'חדש').map(r => r.תעודה));
                
                if (newRequestIds.size > oldNewRequestIds.size) {
                    document.getElementById('notification-sound').play().catch(e => {});
                }

                allRequests = data.requests;
                allClients = data.clients;

                updateDashboard();
                renderOrderBoard();
                renderClients();
            } catch (error) {
                console.error('Error fetching data:', error);
            }
        }

        function updateDashboard() {
            // ... update stats and charts
        }
        
        // ... all other rendering and event handling functions
    </script>
</body>
</html>

